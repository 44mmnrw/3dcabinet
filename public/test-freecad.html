<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FreeCAD ‚Üí Three.js</title>
    <style>
        body { margin: 0; overflow: hidden; font-family: Arial, sans-serif; }
        canvas { display: block; }
        #controls {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.95);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            min-width: 250px;
        }
        #controls h3 { margin: 0 0 15px 0; color: #2c3e50; }
        #controls label { display: block; margin: 10px 0; }
        #controls input[type="range"] { width: 100%; }
        #controls button {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        #controls button:hover { background: #2980b9; }
        #info {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(255,255,255,0.9);
            padding: 15px;
            border-radius: 8px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div id="controls">
        <h3>üîß FreeCAD –º–æ–¥–µ–ª—å</h3>
        
        <label>
            <strong>–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å:</strong>
            <input type="range" id="opacity" min="0" max="100" value="15">
            <span id="opacity-val">15%</span>
        </label>
        
        <label>
            <strong>–¶–≤–µ—Ç –ª–∏–Ω–∏–π:</strong>
            <input type="color" id="line-color" value="#2c3e50">
        </label>
        
        <button id="toggle-edges">–°–∫—Ä—ã—Ç—å —Ä—ë–±—Ä–∞</button>
        <button id="toggle-surfaces">–°–∫—Ä—ã—Ç—å –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏</button>
        
        <hr style="margin: 15px 0; border: none; border-top: 1px solid #ddd;">
        
        <label>
            <strong>–ê–Ω–∏–º–∞—Ü–∏—è –¥–≤–µ—Ä–∏:</strong>
            <input type="range" id="door-angle" min="0" max="90" value="0">
            <span id="door-val">0¬∞</span>
        </label>
        
        <button id="open-door">–û—Ç–∫—Ä—ã—Ç—å –¥–≤–µ—Ä—å</button>
        <button id="close-door">–ó–∞–∫—Ä—ã—Ç—å –¥–≤–µ—Ä—å</button>
        
        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #ddd;">
            <small>–ó–∞–≥—Ä—É–∂–µ–Ω–æ –∏–∑ FreeCAD</small><br>
            <small id="selected-info" style="color: #3498db;"></small>
        </div>
    </div>
    
    <div id="info">
        <strong>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:</strong><br>
        üñ±Ô∏è –í—Ä–∞—â–µ–Ω–∏–µ: –õ–ö–ú<br>
        üîç –ó—É–º: –ö–æ–ª—ë—Å–∏–∫–æ<br>
        ‚ÜîÔ∏è –ü–∞–Ω–æ—Ä–∞–º–∞: –ü–ö–ú
    </div>

    <script type="module">
        import * as THREE from './js/libs/three.module.js';
        import { OrbitControls } from './js/libs/OrbitControls.js';
        import { FreeCADGeometryLoader } from './js/modules/FreeCADGeometryLoader.js';
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ü–µ–Ω—ã
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0xf0f0f0);
        
        const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(1.5, 1, 1.5);
        
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        document.body.appendChild(renderer.domElement);
        
        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.target.set(0, 0.25, 0);
        
        // –û—Å–≤–µ—â–µ–Ω–∏–µ
        scene.add(new THREE.AmbientLight(0xffffff, 0.6));
        const dirLight = new THREE.DirectionalLight(0xffffff, 0.4);
        dirLight.position.set(5, 10, 5);
        scene.add(dirLight);
        
        // –°–µ—Ç–∫–∞ –∏ –æ—Å–∏
        scene.add(new THREE.GridHelper(2, 20, 0xcccccc, 0xeeeeee));
        scene.add(new THREE.AxesHelper(0.5));
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏ –∏–∑ FreeCAD
        const loader = new FreeCADGeometryLoader();
        let cabinetModel;
        
        try {
            cabinetModel = await loader.load('./assets/models/freecad/cabinet_light.json', {
                style: 'technical',
                lineColor: 0x2c3e50,
                surfaceColor: 0x3498db,
                surfaceOpacity: 0.15,
                showEdges: true,
                showSurfaces: true
            });
            
            // –£–º–µ–Ω—å—à–∞–µ–º –≤ 1000 —Ä–∞–∑ (–∏–∑ –º–º –≤ –º–µ—Ç—Ä—ã)
            cabinetModel.scale.set(0.001, 0.001, 0.001);
            
            scene.add(cabinetModel);
            
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
            alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏!');
        }
        
        // UI –∫–æ–Ω—Ç—Ä–æ–ª–ª—ã
        document.getElementById('opacity').addEventListener('input', (e) => {
            const opacity = e.target.value / 100;
            loader.setSurfaceOpacity(opacity);
            document.getElementById('opacity-val').textContent = `${e.target.value}%`;
        });
        
        document.getElementById('line-color').addEventListener('input', (e) => {
            const color = parseInt(e.target.value.replace('#', ''), 16);
            loader.setLineColor(color);
        });
        
        let edgesVisible = true;
        document.getElementById('toggle-edges').addEventListener('click', () => {
            edgesVisible = !edgesVisible;
            loader.toggleEdges(edgesVisible);
            document.getElementById('toggle-edges').textContent = 
                edgesVisible ? '–°–∫—Ä—ã—Ç—å —Ä—ë–±—Ä–∞' : '–ü–æ–∫–∞–∑–∞—Ç—å —Ä—ë–±—Ä–∞';
        });
        
        let surfacesVisible = true;
        document.getElementById('toggle-surfaces').addEventListener('click', () => {
            surfacesVisible = !surfacesVisible;
            loader.toggleSurfaces(surfacesVisible);
            document.getElementById('toggle-surfaces').textContent = 
                surfacesVisible ? '–°–∫—Ä—ã—Ç—å –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏' : '–ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏';
        });
        
        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–≤–µ—Ä—å—é (–æ—Ç–∫–ª—é—á–µ–Ω–æ - –Ω–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏–π –æ–±—ä–µ–∫—Ç–æ–≤ –≤ FreeCAD)
        document.getElementById('door-angle').disabled = true;
        document.getElementById('open-door').disabled = true;
        document.getElementById('close-door').disabled = true;
        document.getElementById('door-angle').title = '–î–ª—è —Ä–∞–±–æ—Ç—ã –Ω—É–∂–Ω—ã –Ω–∞–∑–≤–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤ –≤ FreeCAD';
        document.getElementById('open-door').title = '–î–ª—è —Ä–∞–±–æ—Ç—ã –Ω—É–∂–Ω—ã –Ω–∞–∑–≤–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤ –≤ FreeCAD';
        document.getElementById('close-door').title = '–î–ª—è —Ä–∞–±–æ—Ç—ã –Ω—É–∂–Ω—ã –Ω–∞–∑–≤–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤ –≤ FreeCAD';
        
        // –ê–Ω–∏–º–∞—Ü–∏—è
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }
        
        animate();
        
        // Resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
        
        console.log('‚úÖ –í—Å—ë –≥–æ—Ç–æ–≤–æ!');
    </script>
</body>
</html>
