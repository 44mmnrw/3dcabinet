<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç HDR –∑–∞–≥—Ä—É–∑–∫–∏</title>
    <style>
        body { margin: 0; font-family: monospace; }
        canvas { display: block; width: 100%; height: 100vh; }
        #log { position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.8); color: lime; padding: 10px; max-width: 400px; }
    </style>
</head>
<body>
    <div id="log">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    <script type="module">
        import * as THREE from './js/libs/three.module.js';
        import { RGBELoader } from './js/libs/RGBELoader.js';
        
        const log = document.getElementById('log');
        function addLog(msg) {
            console.log(msg);
            log.innerHTML += '<br>' + msg;
        }
        
        addLog('‚úÖ Three.js –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω');
        addLog('‚úÖ RGBELoader –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω');
        
        // –°—Ü–µ–Ω–∞
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.z = 5;
        
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.toneMapping = THREE.ACESFilmicToneMapping;
        renderer.toneMappingExposure = 1.0;
        renderer.outputColorSpace = THREE.SRGBColorSpace;
        document.body.appendChild(renderer.domElement);
        
        addLog('‚úÖ –†–µ–Ω–¥–µ—Ä–µ—Ä —Å–æ–∑–¥–∞–Ω');
        
        // –ö—É–± –¥–ª—è —Ç–µ—Å—Ç–∞ –æ—Ç—Ä–∞–∂–µ–Ω–∏–π
        const geometry = new THREE.SphereGeometry(2, 64, 64);
        const material = new THREE.MeshStandardMaterial({
            color: 0xffffff,
            metalness: 1.0,
            roughness: 0.1
        });
        const sphere = new THREE.Mesh(geometry, material);
        scene.add(sphere);
        
        addLog('‚úÖ –°—Ñ–µ—Ä–∞ —Å–æ–∑–¥–∞–Ω–∞ (–º–µ—Ç–∞–ª–ª)');
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ HDR
        const rgbeLoader = new RGBELoader();
        const pmremGenerator = new THREE.PMREMGenerator(renderer);
        
        addLog('üîÑ –ù–∞—á–∏–Ω–∞—é –∑–∞–≥—Ä—É–∑–∫—É HDR...');
        
        rgbeLoader.load(
            '/assets/hdri/warehouse.hdr',
            (texture) => {
                addLog('üì¶ HDR –∑–∞–≥—Ä—É–∂–µ–Ω, —Ä–∞–∑–º–µ—Ä: ' + texture.image.width + 'x' + texture.image.height);
                
                const envMap = pmremGenerator.fromEquirectangular(texture).texture;
                scene.environment = envMap;
                scene.background = envMap;
                
                texture.dispose();
                pmremGenerator.dispose();
                
                addLog('‚úÖ HDR Environment —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!');
                addLog('üé® –°–º–æ—Ç—Ä–∏—Ç–µ –æ—Ç—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ —Å—Ñ–µ—Ä–µ');
            },
            (progress) => {
                const percent = Math.round((progress.loaded / progress.total) * 100);
                addLog('‚è≥ –ó–∞–≥—Ä—É–∂–µ–Ω–æ: ' + percent + '%');
            },
            (error) => {
                addLog('‚ùå –û–®–ò–ë–ö–ê –∑–∞–≥—Ä—É–∑–∫–∏ HDR: ' + error.message);
                console.error('–ü–æ–ª–Ω–∞—è –æ—à–∏–±–∫–∞:', error);
            }
        );
        
        // –ê–Ω–∏–º–∞—Ü–∏—è
        function animate() {
            requestAnimationFrame(animate);
            sphere.rotation.y += 0.01;
            renderer.render(scene, camera);
        }
        animate();
        
        addLog('‚úÖ –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞–ø—É—â–µ–Ω–∞');
    </script>
</body>
</html>
