# üöÄ Fix: Race Condition –ø—Ä–∏ Drag-Drop + Socket_g Debug

## –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### –ü—Ä–æ–±–ª–µ–º–∞ 1: Race Condition –Ω–∞ –ø–µ—Ä–≤—ã–π –∫–ª–∏–∫
- **–û—à–∏–±–∫–∞**: "‚ö†Ô∏è –°–Ω–∞—á–∞–ª–∞ –¥–æ–±–∞–≤—å—Ç–µ —à–∫–∞—Ñ –Ω–∞ —Å—Ü–µ–Ω—É!" –ø—Ä–∏ –ø–µ—Ä–≤–æ–º drag-drop –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞–±–∏–Ω–µ—Ç–∞
- **–ü—Ä–∏—á–∏–Ω–∞**: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∫–∞–±–∏–Ω–µ—Ç–∞, –∫–ª–∏–∫ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ Map
- **–†–µ—à–µ–Ω–∏–µ**: Event-based —Ñ–ª–∞–≥ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ EventBus

### –ü—Ä–æ–±–ª–µ–º–∞ 2: Socket_g –Ω–µ —Ä–∞–±–æ—Ç–∞–ª
- **–û—à–∏–±–∫–∞**: "–†–æ–∑–µ—Ç–∫–∞ 220" –Ω–µ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ drag-drop
- **–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ—è—Å–Ω–∞ (–∫–æ–Ω—Ñ–∏–≥ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
- **–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω–æ debug-–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥–∞

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è

```
‚úÖ public/js/core/DragDropController.js
   - –î–æ–±–∞–≤–ª–µ–Ω eventBus –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä
   - –î–æ–±–∞–≤–ª–µ–Ω —Ñ–ª–∞–≥ this.isReady
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–ª–∞–≥–∞ –≤ _onDragStart()
   - Debug-–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥–∞

‚úÖ public/js/managers/init.js
   - –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω eventBus
   - –ü–µ—Ä–µ–¥–∞–Ω eventBus –≤ DragDropController
   - –û–±–Ω–æ–≤–ª–µ–Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

üìÑ docs/RACE_CONDITION_FIX.md
   - –ü–æ–ª–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

üìÑ docs/TEST_CHECKLIST.md
   - –ü–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

üìÑ RACE_CONDITION_FIX_SUMMARY.md
   - –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á—ë—Ç (–≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞)

üß™ debug-script.js
   - –ö–æ–Ω—Å–æ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
```

## –ö–∞–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

### –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç (30 —Å–µ–∫)

1. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:5175/
2. –ù–∞–∂–º–∏—Ç–µ "–ó–∞–≥—Ä—É–∑–∏—Ç—å —à–∫–∞—Ñ" 
3. **–ù–ï–ú–ï–î–õ–ï–ù–ù–û** –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ "–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–∫–ª—é—á–∞—Ç–µ–ª—å"
   - ‚úÖ –†–ê–ë–û–¢–ê–ï–¢: Drag-drop –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ alert
   - ‚ùå –û–®–ò–ë–ö–ê: Alert "–°–Ω–∞—á–∞–ª–∞ –¥–æ–±–∞–≤—å—Ç–µ —à–∫–∞—Ñ..."

### –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç (2-3 –º–∏–Ω)

–°–º–æ—Ç—Ä–∏ `docs/TEST_CHECKLIST.md`

## –û—Ç–ª–∞–¥–∫–∞

### –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (F12 ‚Üí Console)

```javascript
// –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å debug-—Å–∫—Ä–∏–ø—Ç:
const script = document.createElement('script');
script.src = '/debug-script.js';
document.head.appendChild(script);

// –ò–ª–∏ –ø—Ä–æ—Å—Ç–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ debug-script.js –≤ –∫–æ–Ω—Å–æ–ª—å
```

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏

```javascript
// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å
window.checkDragDropReady()

// –≠–º–∏—Ç–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ –≤—Ä—É—á–Ω—É—é
window.testCabinetAdded()

// –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å drag –¥–ª—è socket_g
window.testDragStart('socket_g')
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

| –ü—Ä–æ–±–ª–µ–º–∞ | –°—Ç–∞—Ç—É—Å | –î–µ—Ç–∞–ª–∏ |
|----------|--------|--------|
| Race condition | ‚úÖ FIXED | Event-based —Ñ–ª–∞–≥ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ |
| Socket_g –æ—Ç–ª–∞–¥–∫–∞ | ‚úÖ ADDED | –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥–∞ |
| –û—à–∏–±–∫–∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ | ‚úÖ NONE | Vite –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç –±–µ–∑ –æ—à–∏–±–æ–∫ |

## –ü—É—Ç—å –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É

1. ‚úÖ –ö–æ–¥ –≥–æ—Ç–æ–≤
2. ‚è≥ **–¢—Ä–µ–±—É–µ—Ç—Å—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** 
3. üì¶ –ì–æ—Ç–æ–≤–æ –∫ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—é

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

```
docs/
‚îú‚îÄ‚îÄ RACE_CONDITION_FIX.md       ‚Üê –ü–æ–ª–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ + –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
‚îú‚îÄ‚îÄ TEST_CHECKLIST.md            ‚Üê –ü–æ—à–∞–≥–æ–≤—ã–µ —Ç–µ—Å—Ç—ã
‚îî‚îÄ‚îÄ ...

RACE_CONDITION_FIX_SUMMARY.md   ‚Üê –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á—ë—Ç (–≤ –∫–æ—Ä–Ω–µ)
debug-script.js                  ‚Üê –ö–æ–Ω—Å–æ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
```

## –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ —Ç–æ—á–∫–∏

- ‚úÖ –ö–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ EventBus –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω
- ‚úÖ DragDropController –ø–æ–ª—É—á–∞–µ—Ç eventBus
- ‚úÖ Cabinet:added —Å–æ–±—ã—Ç–∏–µ —ç–º–∏—Ç–∏—Ç—Å—è
- ‚úÖ –§–ª–∞–≥ isReady —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è
- ‚è≥ –ü–µ—Ä–≤—ã–π drag-drop —Ä–∞–±–æ—Ç–∞–µ—Ç (—Ç—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞)
- ‚è≥ Socket_g —Ä–∞–±–æ—Ç–∞–µ—Ç (—Ç—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞)

---

**–°—Ç–∞—Ç—É—Å**: –ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
**–í–µ—Ä—Å–∏—è**: 1.0.0
**–î–∞—Ç–∞**: 2025-01-20
