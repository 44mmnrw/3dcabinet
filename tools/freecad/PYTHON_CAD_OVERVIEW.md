# Python & CAD / FreeCAD — Краткий обзор возможностей

> Цель: дать быстрое представление о том, что можно автоматизировать и построить через Python в области CAD в целом и в FreeCAD в частности.

## 1. Общие направления применения Python в CAD
- Параметрическое моделирование: генерация геометрии по формулам, конфигураторам, входным JSON/CSV.
- Автоматизация рутины: серийные операции (обрезка, отверстия, скругления, массивы, экспорт форматов).
- Конвертация и подготовка данных: импорт/экспорт между STEP / STL / OBJ / DXF / собственными JSON/CSV.
- Массовые изменения: пересчёт размеров, обновление зависимых деталей, batch-регерация сборок.
- Генерация производственных файлов: 2D-чертежи, листовые раскройки, CAM траектории (через внешние плагины), BOM.
- Аналитика и верификация: вычисление объёмов, масс, центров тяжести, коллизий.
- Интеграция: связь с веб-сервисами, PLM/PDM системами, базами данных.

## 2. Ключевые области FreeCAD API
- Документ/сцена: `App.newDocument()`, объекты `Part::Feature`, `PartDesign::Body`, группировка.
- Геометрия ядра (Part): примитивы (Box, Cylinder...), булевы операции (fuse/common/cut), топология (Vertex/Edge/Wire/Face/Shell/Solid), импорт STEP/IGES.
- Sketcher: создание эскизов, добавление геометрии (Line, Arc...), наложение constraints (Distance, Coincident, Radius), параметрическое обновление.
- PartDesign: операции на теле: Pad, Pocket, Fillet, Chamfer, Pattern (Linear/Polar), Thickness.
- Mesh: импорт/генерация/дефектация треугольных сеток (STL/OBJ), ремонт и упрощение.
- Draft/Arch: высокоуровневые объекты (стены, профили) и 2D-инструменты.
- TechDraw: генерация листов чертежей, проекций, размеров, экспорт PDF/SVG.
- Materials & Props: пользовательские свойства (addProperty) для метаданных (артикул, масса, покрытие).
- Units: единицы и преобразования (`App.Units.Quantity`).
- GUI слой: выделение, отчёты, диалоги (PySide), макросы, тулбары.

## 3. Типичные сценарии скриптов
- "Генератор профилей": создаёт параметризованный контур (DIN-рейки, экструдирует до длины).
- "Пакетный экспортер": обходит все детали и сохраняет в STEP + STL.
- "Обновление размеров": читает CSV, применяет новые параметры к эскизам, пересчитывает документ.
- "Анализ коллизий": перебор пар solids и проверка пересечений (shape.common). 
- "Снижение полигональности": тесселяция с разным допуском и сравнение отклонений.
- "Сборка отчёта": агрегирует объёмы, массы, пишет JSON/BOM.

## 4. Работа с геометрией (Part)
- Примитивы: `Part.makeBox(l, w, h)`, `Part.makeCylinder(r, h)`.
- Конструктивная логика: fuse (объединение), cut (вычитание), common (пересечение).
- Модификация: fillet/chamfer через `shape.makeFillet(radius, [edges])`.
- Тесселяция: `shape.tessellate(deflection)` → mesh (вершины + треугольники) для WebGL/Three.js.
- Проверка: `shape.isValid()`, Part → Check Geometry.

## 5. Эскизы и параметры
- Создание: `sk = doc.addObject('Sketcher::SketchObject','Sketch')`.
- Геометрия: `addGeometry(Part.LineSegment(p1, p2))` и др.
- Constraints: `addConstraint(Sketcher.Constraint('Distance', idx, value))`.
- Привязка: изменение constraint → parametric перестройка тела.

## 6. Пользовательские свойства и метаданные
- `obj.addProperty('App::PropertyString','Article','Meta')` → хранение артикулов.
- Типы: String, Float, Integer, Bool, Enumeration, Quantity, Link.
- Использование: фильтрация, экспорт в BOM JSON/CSV.

## 7. Импорт/Экспорт
- STEP/IGES: высокоточная геометрия (solids) — `import ImportGui` / `Part.export`.
- STL/OBJ: сетки (для печати/веб) — `Mesh.export`.
- DXF/SVG: 2D контуры и чертежи.
- Пользовательские форматы: сериализация вершин/граней/свойств в JSON.

## 8. Аналитика и расчёты
- Объём и площадь: `shape.Volume`, `shape.Area`.
- Центр масс: `shape.CenterOfMass`.
- Момент инерции: `shape.MatrixOfInertia`.
- Габариты: `shape.BoundBox`.
- Коллизии: `if not shape.common(other).isNull()`.

## 9. Параметрические конфигураторы
- Хранение параметров в JSON/DB → генерация геометрии по запросу.
- Веб-интеграция: сервер генерирует STEP/STL на лету (headless FreeCAD) и отдаёт ссылку.
- Кэширование: сохранение результатов для одинаковых параметрических комбинаций.

## 10. Интеграция с веб/DevOps
- Headless запуск: `freecadcmd script.py --args ...`.
- REST слой: Python скрипт обрабатывает параметры → генерирует файл → возвращает URL.
- Контроль версий геометрии: хранение параметров + git, а не тяжёлых бинарей.
- Генерация превью изображений (рэндер через Raytracing WB или POV-Ray).

## 11. GUI автоматизация (PySide)
- Диалоги ввода: `QInputDialog`, `QFileDialog`.
- Прогресс-бары: `QProgressDialog` при долгих batch операциях.
- Кнопки/панели: регистрация макроса на тулбар через настройки FreeCAD.

## 12. Оптимизация и производительность
- Снижайте количество булевых операций (объединяйте). 
- Используйте эскиз + фичи вместо набора отдельных примитивов.
- Тесселяция: подбирайте `deflection`; маленькое значение = точность ↑, время ↑.
- Кеширование промежуточных solids.

## 13. Ограничения / подводные камни
- Булевые операции иногда дают self-intersections → проверять isValid.
- Сетки (Mesh) не конвертируются идеально обратно в solids (требуется ремешинг или BRep реконструкция).
- Эскизные зависимости могут стать сверхопределёнными (over-constrained).
- Headless режим ограничивает функции GUI (нужны проверки try/except).

## 14. Расширяемость
- Модули Workbench на Python (структура init.py + InitGui.py).
- Плагины для специфичных профилей / стандартов (DIN/ISO/ГОСТ).
- Генераторы отчётов и экспорта BOM автоматически при сохранении.

## 15. Когда лучше не писать с нуля
- Сложная топология: использовать существующие STEP библиотеки.
- CAM: отдавать в специализированные инструменты (FreeCAD Path WB — базовый, для продакшена может быть мало).
- Фотореализм: экспорт в Blender, использовать Cycles.

## 16. Связь с Three.js / Web
- Экспорт тесселяции → JSON (vertices, indices, normals) → Three.js BufferGeometry.
- Конвертация через промежуточный STL + загрузка в триангулятор в браузере.
- Сжатие: Draco или meshopt (после генерации). 

## 17. Минимальный пример: генерировать и экспортировать профиль
```python
import FreeCAD as App, Part
DOC = App.newDocument()
rail = Part.makeBox(450, 35, 7)  # Условный прямоугольный профиль
obj = DOC.addObject('Part::Feature','Rail')
obj.Shape = rail
DOC.recompute()
# DOC.saveAs('rail.FCStd')  # сохранить, export STEP: Part.export([obj], 'rail.step')
```

## 18. Что добавлять дальше
- Авто-подбор крепёжных отверстий по шаблону.
- Генерация 2D эскизов для TechDraw.
- API-слой для внешнего веб-конфигуратора.

---
**TL;DR**: Python в CAD (и FreeCAD) = параметрическая генерация + автоматизация + интеграция. Вы описываете логику в коде, а не кликами. Это ускоряет изменения, снижает ошибки и позволяет строить веб-конфигураторы и пайплайны.
