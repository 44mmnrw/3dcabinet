# Инструкции для AI-ассистента — 3Cabinet

## Архитектура проекта

**Тип приложения**: Одностраничный веб-конфигуратор (SPA) на Vanilla JS с 3D-визуализацией.

**Две отдельные точки входа**:
1. `index.php` — лендинг и форма выбора параметров конфигурации ( 2-шаговый опрос)
2. `app.php` — основное приложение конфигуратора с тремя панелями (слева: каталог, центр: 3D-визуализация, справа: параметры)

**Архитектура без зависимостей**: Vanilla JS + Three.js (встроена локально в `js/libs/`), без npm, webpack, build-шагов.

**Клиент-сайд логика**: Всё состояние и обработка — в браузере. Никаких обращений к серверу во время работы приложения (кроме возможного сохранения проектов).

---

## Ключевые файлы и их роль

### Фронтенд
- **`js/app.js`** — Основной модуль (ES6 import):
  - Инициализация Three.js сцены (камера, освещение, рендерер)
  - Создание 3D-модели шкафа и рельсов (6 линейных элементов)
  - OrbitControls для вращения камеры
  - WebGL проверка и обработка ошибок инициализации
  
- **`js/selection.js`** — Управление 2-шаговой формой (`index.php`):
  - Обработчики кликов на карточки выбора (место и тип установки)
  - Синхронизация radio-inputs с `.active` классами
  - Управление прогресс-баром и видимостью блоков (класс `.hidden`/`.visible`)
  - Активация финальной кнопки (только если оба выбора сделаны)

- **`js/data.js`** — Статические данные:
  - Массив `EQUIPMENT_DATA` с 12+ типами оборудования (id, name, units, power, weight, depth, category)
  - Объект `CABINET_CONFIG` (параметры шкафа: 42U, 600×800 мм, 800 кг макс)

### Стили и вёрстка
- **`css/styles.css`** — Единственный активный CSS-файл (1000+ строк):
  - CSS-переменные `:root` (цвета, отступы, шрифты, радиусы, тени)
  - Шрифт: Inter Variable (woff2, 100-900 вес)
  - Responsive grid-система: 3 панели на десктопе, перестройка на мобильных
  - Анимации: прогресс-бар, галка в карточке (stroke-dashoffset), hover-эффекты

- **`css/reset.css`** — Базовый сброс стилей
- **`css/old_styles.css`** — Заброшенные стили (игнорировать)

- **`index.php`** — Лендинг и форма выбора:
  - Header с логотипом (трёхчастная SVG-композиция с hover-эффектами)
  - First-section: левая часть (текст + чек-лист), правая часть (форма с карточками)
  - Second-section: 4 step-card (процесс конфигурирования)
  - Third-section: 3-колоночный promo-banner

- **`app.php`** — Основной конфигуратор (не используется в этом моменте, но структурирован):
  - 3-панельная сетка: `.panel-left` (каталог), `.panel-center` (3D), `.panel-right` (параметры)
  - ID: `#cabinet-3d-container` — контейнер для Three.js canvas

### Активы
- **`assets/sprite/sprite.svg`** — SVG-спрайт с иконками:
  - Подключается через `<?php include ?>` в скрытый div
  - Используется через `<use xlink:href="#icon-name" />`
  - Иконки: логотип (3 части), чек-листы, облако, кубик и т.д.

- **`fonts/InterVariable.woff2` и `-Italic.woff2`** — Вариативные шрифты

### Серверная часть (справочная информация)
- **`admin.php`** — Административный интерфейс (заполненный, но не используется в app.php)
- **`config.php`** — Конфигурация БД (возможное будущее расширение)
- **`db_structure.php`** — Схема БД (заглушка)
- **`debug.php`** — Вспомогательный скрипт для отладки

---

## Форматы и структуры данных

### EQUIPMENT_DATA (массив в `js/data.js`)
```javascript
{
  id: 1,                    // уникальный идентификатор
  name: "Коммутатор Cisco 2960",
  description: "24-port Gigabit Switch",
  units: 1,                 // занимаемые U-slots в шкафу (1-4)
  power: 45,                // вт (0 для пассивного оборудования)
  weight: 3.2,              // кг
  depth: 250,               // мм
  category: "network"       // "network", "server", "power", "accessories"
}
```

### CABINET_CONFIG (объект в `js/data.js`)
```javascript
{
  name: 'Стандарт 19" RACK',
  units: 42,                // всего U-slots
  width: 600,               // мм
  depth: 800,               // мм
  maxWeight: 800,           // кг
  maxPower: 3500            // вт
}
```

### Состояние выбора (в `js/selection.js`)
```javascript
selectedLocation: boolean,      // место установки выбрано
selectedInstallation: boolean   // тип установки выбран
```

---

## Паттерны и соглашения

### Стилизация через классы
- **`.hidden` / `.visible`** — управление видимостью с CSS transitions
  ```css
  .hidden { display: none !important; opacity: 0; max-height: 0; }
  .visible { display: grid !important; opacity: 1; max-height: 500px; }
  ```
  
- **`.active`** — выбранная карточка получает светлый фон и фиолетовую границу
  ```javascript
  card.classList.add('active'); // в response на клик
  ```

- **`.disabled-button`** — неактивная кнопка (серый фон, нет events)
  ```css
  .disabled-button { background-color: #B2BEC3 !important; cursor: not-allowed; pointer-events: none; }
  ```

### Управление формой
- Radio-inputs скрыты (`display: none`), видны только custom-radio (кружок + SVG-галка)
- При клике на `.select-card`: устанавливается `.active` класс И проверяется `radio.checked`
- Анимация галки: `stroke-dashoffset` идёт от 30 к 0, сопровождается `scale(1.1)` пульсом

### Three.js сцена (в `js/app.js`)
- **Сцена**: белый фон, оси координат (AxesHelper), светлая сетка
- **Камера**: PerspectiveCamera, позиция `-width/2, height*0.86, camDistance` (косой вид сверху)
- **Освещение**:
  - AmbientLight: интенсивность 1 (базовое)
  - DirectionalLight: направлен с вверху-справа, создаёт тень
- **Шкаф**: BoxGeometry (600×1872×1000 мм для 42U), + 4 рельса (стойки) спереди/сзади
- **Рендерер**: WebGLRenderer с antialiasing, PCFSoftShadowMap, devicePixelRatio

---

## Рабочие процессы

### Развитие функционала
1. **Добавить оборудование** → редактируйте `EQUIPMENT_DATA` в `js/data.js`
2. **Изменить параметры шкафа** → редактируйте `CABINET_CONFIG`
3. **Обновить стили** → редактируйте CSS-переменные в `:root` (`css/styles.css` строка 56)
4. **Добавить иконку** → экспортируйте SVG-путь в `assets/sprite/sprite.svg`

### Запуск и тестирование
- **Локальный просмотр лендинга**: Откройте `index.php` в браузере (File → Open или PHP сервер)
- **Просмотр конфигуратора**: Откройте `app.php` (требует правильной структуры DOM и id)
- **Отладка**: Открыте DevTools (F12) → Console для логов `console.log` из `init()`
- **Проверка 3D**: Убедитесь, что WebGL поддерживается (DevTools → Application → WebGL 1/2)

### Адаптивность
- Брейкпоинты: 1024px, 900px, 768px, 430px, 375px
- Мобильный дизайн: 1-колоночная grid, масштабирование логотипа, переход кнопок в 1 колонку
- Ландшафтная ориентация: минимальные паддинги, коррекция высоты header

---

## Важные инварианты

1. **Целостность данных в `EQUIPMENT_DATA`**: 
   - Все `id` должны быть уникальны
   - `units` должны быть 1-4 (стандартные размеры рака)
   - `category` должны соответствовать фильтрам в UI (если они будут добавлены)

2. **Синхронизация форм и состояния**:
   - Каждый `.select-card` должен иметь внутри `<input type="radio">` с одинаковым `name`
   - При клике на карточку ОБЯЗАТЕЛЬНО устанавливается `.active` И `radio.checked = true`

3. **Кэширование DOM-ссылок**:
   - В `selection.js` элементы кэшируются один раз в IIFE-scope
   - Не переделывайте `querySelector` на каждое событие

4. **Порядок включения скриптов** (в HTML):
   - Сначала `js/data.js` (данные доступны глобально)
   - Затем `js/app.js` (Three.js сцена) — использует ES6 import
   - Затем `js/selection.js` (форма выбора в самозапускающейся IIFE)

---

## Ограничения и требования

- ❌ **Не добавляйте npm-зависимости** без явного согласия (проект без build-процесса)
- ❌ **Не конвертируйте `js/app.js` на CommonJS** или UMD (текущий ES6 import работает с `<script type="module">` в HTML)
- ❌ **Не меняйте структуру `CABINET_CONFIG` без обновления 3D-сцены** (параметры жёстко привязаны к математике камеры)
- ✅ **Всегда обновляйте документацию** при изменении формата данных
- ✅ **Тестируйте на мобильных** при изменении CSS (4 основных брейкпоинта)
- ✅ **Используйте `console.log`** для отладки — нет встроенного дебаггера

---

## Если что-то неясно

- 3D-сцена выглядит пустой? Проверьте WebGL в консоли и размеры контейнера `#cabinet-3d-container`
- Форма не срабатывает? Убедитесь, что `selection.js` подключен ПОСЛЕ `index.php`
- Стили не применяются? Проверьте CSS-переменные в `:root` и специфичность селекторов
- Иконка не видна? Проверьте ID иконки в спрайте и в `xlink:href`
